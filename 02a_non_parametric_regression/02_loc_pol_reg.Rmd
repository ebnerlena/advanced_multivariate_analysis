---
title: "Practice. Local polynomial regression"
author: "Pedro Delicado"
output:
  html_document:
    number_sections: yes
  pdf_document:
    fig_caption: yes
    number_sections: yes
classoption: a4paper
---
<!-- Comment lines are like this one -->
<!-- Use "\newpage" when you want a new page break in the pdf output  -->


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Aircraft Data

Calling library **sm**.
```{r,message=FALSE}
library(sm)
```

Reading the data and taking logarithms.
```{r,message=FALSE}
data(aircraft)
# help(aircraft)
attach(aircraft)

lgPower <- log(Power)
lgSpan <- log(Span)
lgLength <- log(Length)
lgWeight <- log(Weight)
lgSpeed <- log(Speed)
lgRange <- log(Range)
```

Scatterplots of log variables against year (`Yr`)
<!-- also possible ```{r, fig.width=7, fig.asp=1} or ```{r, fig.asp=1}-->
```{r, fig.width=7, fig.height=10, fig.asp=1} 
op<-par(mfrow=c(3,2))
plot(Yr,lgPower)
plot(Yr,lgSpan)
plot(Yr,lgLength)
plot(Yr,lgWeight)
plot(Yr,lgSpeed)
plot(Yr,lgRange)
par(op)
```




# Local polynomial regression for Aircraft data


Using the function `locpolreg`.
```{r}
source("./locpolreg.R")
```


Local polynomial regression with `locpolreg`.

* Regression of `lgSpeed` against `Yr`.
```{r, fig.asp=.5}
op <- par(mfrow=c(1,3))
# h = 7 because putting almost all prbbability between +-15 for each point
res0 <- locpolreg(x=Yr,y=lgSpeed,h=7,q=0,r=0,main="q=0,h=7")
res1 <- locpolreg(x=Yr,y=lgSpeed,h=7,q=1,r=0,main="q=1,h=7")
res2 <- locpolreg(x=Yr,y=lgSpeed,h=7,q=2,r=0,main="q=2,h=7")
par(op)
```



# Local polynomial estimation in R


## Using the `locpoly` function from library `KernSmooth`.

* Regression of `lgSpeed` against `Yr`.

```{r,message=FALSE}
library(KernSmooth)
# uses a grid to estimate points
lpr1 <- locpoly(Yr,lgSpeed, bandwidth=7)
plot(Yr,lgSpeed,col="grey")
lines(lpr1,lwd=2)
```


## Using the `sm.regression` function from library `sm`.

```{r,message=FALSE}
library(sm)
# allows uses local linear regression
# eval.points = possibility to say at which point you want to estimate the functions
lpr1_sm <- sm.regression(Yr,lgSpeed, h=7)
```
